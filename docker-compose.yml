# Local Unleash instance for LogiOps feature flag development.
# Start with: docker-compose up -d
# Unleash UI: http://localhost:4242 (admin / unleash4all)
#
# The flag service deployed at https://unleash-flag-service-ddyinhlr.fly.dev
# mirrors this configuration for the hosted CodeCull demo.

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: unleash
      POSTGRES_USER: unleash
      POSTGRES_PASSWORD: unleash
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U unleash"]
      interval: 5s
      timeout: 3s
      retries: 20
    volumes:
      - unleash_pg_data:/var/lib/postgresql/data

  unleash:
    image: unleashorg/unleash-server:latest
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "4242:4242"
    environment:
      DATABASE_URL: postgres://unleash:unleash@postgres:5432/unleash
      DATABASE_SSL: "false"
      INIT_ADMIN_API_TOKENS: "default:development.unleash-insecure-api-token,default:development.unleash-insecure-client-api-token"
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://localhost:4242/health || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 30
      start_period: 30s

volumes:
  unleash_pg_data:
